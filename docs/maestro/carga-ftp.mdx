---
title: Uso de SFTP
sidebarTitle: Uso de SFTP
description: Orientações para importação automática de Templates e Campanhas via SFTP no Robbu Maestro, incluindo padrões de arquivos, diretórios e fluxo de processamento.
---

# Carga SFTP de Templates & Campanhas  

Esta documentação orienta como usar os serviços automáticos de importação via **SFTP** para **Templates** e **Campanhas** no **Robbu Maestro**.  

---

## Configuração
A configuração de SFTP pode ser feita na seção Configurações > Empresa > Transferência de Arquivos

A Gerente de Ambiente pode decidir se as assessorias poderão utilizar um SFTP próprio ou somente o gerenciado pela Robbu.

Há duas formas de conectar um servidor SFTP ao Maestro:

### SFTP Robbu
A Robbu disponibiliza um servidor SFTP gerenciado, pronto para uso imediato
- Ao habilitar, o sistema fornece:  
  - **Nome de usuário**  
  - **Senha**  
  - **Porta**  
  - **Servidor**

### SFTP Próprio
A própria empresa gerencia o seu SFTP.

> ⚠️ **Atenção:** Essa opção deve ser habilitada pela Gerente de Ambiente nas configurações de Ambiente

> ⚠️ Se algum parâmetro estiver em branco ou inválido, a importação será ignorada

Essa flexibilidade permite que cada empresa defina o modelo mais adequado ao seu nível de governança e requisitos de segurança.

## Segurança
- É fundamental manter as credenciais em segurança.  
- Garantir o correto uso de **porta** e **endereço do servidor** para estabelecer a conexão.  
- A proteção desses dados garante a **integridade dos arquivos** durante as transferências.

## Diretórios  

O Maestro utiliza a seguinte árvore de diretórios dentro do servidor SFTP

| Uso                      | Caminho SFTP                   |
|--------------------------|--------------------------------|
| Templates a serem importados        | `/maestro/templates`           |
| Campanhas a serem importadas        | `/maestro/campaigns`           |

Dentro de cada um dos diretórios acima, duas pastas serão criadas:
`/processed` para identificar os objetos importados com sucesso
`/error` para identificar importações que não aconteceram e sinalizar qual foi o erro encontrado

> ⚠️ Estes diretórios são criados automaticamente após a conexão do servidor SFTP na tela de configuração, mas pode levar até 10 minutos para que esses diretórios apareçam.

---

## Padrões de Nome de Arquivo  

### Templates  
```plaintext
{segmentName}_{channelName}_[{wabaDescription}]_{YYYYMMDD}.csv
```
- **segmentName**: nome exato do segmento configurado (Maestro/Segmentos).  
- **channelName**: `email` | `sms` | `whatsapp` (case-insensitive).  
- **wabaDescription** *(opcional, apenas WhatsApp)*: descrição da WABA.  
- **YYYYMMDD**: data de referência (ex: `20250531`).  

**Exemplos**  
- `retail_email_20250510.csv`  
- `finance_sms_20250101.csv`  
- `store_whatsapp_MinhaWaba_20250320.csv`  

---

### Campanhas  

```plaintext
{segmentName}_{channelName}_{templateCode}[_{whatsappNumber}]_{YYYYMMDD}_{HHmm}.csv
```

- **segmentName**: igual ao acima.  
- **channelName**: `email` | `sms` | `whatsapp`.  
- **templateCode**: código do template (ex: `E0001`, `S0123`, `W0456`).  
- **whatsappNumber** *(obrigatório no WhatsApp)*: número do telefone.  
- **YYYYMMDD**: data (ex: `20250515`).  
- **HHmm**: hora de agendamento (24h).  

**Exemplos**  
- `retail_email_E0001_20250515_0830.csv`  
- `finance_sms_S0002_20250601_1200.csv`  
- `store_whatsapp_W0003_5511999999999_20250720_1905.csv`  

---

## Fluxo de Processamento

### Templates
1. Upload do `.csv` em `/maestro/templates`
2. Serviço rotineiro (a cada 10 min) executa:  
   - Garante diretórios `processed` e `error`.  
   - Varre os arquivos `.csv`.  
3. Validações:  
   - Nome do arquivo segue o padrão?
   - Segmento existe e assessoria possui permissão de acesso?
4. Importação:
   - Cria os templates já com status `Em Revisão`
5. Move o `.csv` para:  
   - `processed` em caso de sucesso.
   - `error` em caso de falha.  
      - Gera `{nome do arquivo original}_errorDetail.txt` com mensagem de erro.  


### Campanhas
1. Upload do `.csv` em `/maestro/campaigns`
2. Serviço rotineiro (a cada 10 min) executa:  
   - Garante diretórios `processed` e `error`.  
   - Varre os arquivos `.csv`.  
3. Validações:
   - Nome do arquivo segue o padrão?
   - Segmentos existem e assessoria possui permissão de acesso?
   - Templates estão aprovados?
   - Regras do motor de regras estão válidas?
4. Importação:
   - Roda as validações
   - Adiciona colunas `Valid` (true, false) e `Reason` (string) ao final do arquivo
   - Há provedor para o canal configurado?
      - Se não, apenas move o arquivo .csv com as novas colunas para a pasta `/processed`
      - Se sim, cria os disparos e depois move o arquivo .csv com as novas colunas para a pasta `/processed
5. Se houver falha no arquivo inteiro
   - Gera `{nome do arquivo original}_errorDetail.txt` com mensagem de erro na pasta `/error`
---

## FAQ

<AccordionGroup>

<Accordion title="Posso enviar arquivos sem seguir o padrão de nomenclatura?">
Não. O arquivo será rejeitado e movido para a pasta **error** com um `_errorDetail.txt`.
</Accordion>

<Accordion title="Preciso recriar os diretórios processed e error manualmente?">
Não. O sistema os cria automaticamente quando não existirem.
</Accordion>

<Accordion title="Posso reaproveitar um arquivo já processado?">
Não. Arquivos em `processed` não são reprocessados. Para enviar novamente, gere um novo `.csv`.
</Accordion>

<Accordion title="Com que frequência os arquivos são processados?">
A cada **10 minutos**, via job automático em container.
</Accordion>

<Accordion title="É possível simular o processo em ambiente de QA?">
Sim, usando os endpoints `/v1/templates/ftp/process` ou `/v1/campaigns/ftp/process`.
</Accordion>

</AccordionGroup>

