---
title: "API Send Message"
sidebarTitle: "Send Message"
description: "Este documento traz as especifica√ß√µes t√©cnicas para chamada da API SendMessage que faz disparos de mensagens via Invenio, independente do canal."
---

A API SendMessage √© o recurso que permite disparar mensagens pela plataforma Invenio de forma unificada, 
independentemente do canal utilizado. Com ela, sua empresa pode enviar mensagens por WhatsApp, SMS e E-mail, incluindo o uso de templates HSM, textos livres e arquivos.
Esse endpoint foi desenvolvido para facilitar a automa√ß√£o da comunica√ß√£o, tornando poss√≠vel integrar outros sistemas ao Invenio e centralizar a gest√£o de envios.

---

## Autentica√ß√£o

Antes de realizar o envio de mensagens pela API, √© necess√°rio obter um token de acesso (access_token). Esse token √© solicitado na rota de
login e deve ser utilizado na chamada da API SendMessage como um Bearer Token, funcionando como a autoriza√ß√£o para que o disparo seja conclu√≠do
com sucesso.

> ‚ö†Ô∏è **Importante**:
> Caso o token n√£o seja informado, ou esteja expirado, a API retornar√° o erro **401 Unauthorized** impedindo o envio da mensagem.

O  usu√°rio utilizado na requisi√ß√£o de login precisa ser do tipo **API**, garantindo a seguran√ßa e o correto funcionamento da integra√ß√£o.

[Acesse a documenta√ß√£o sobre Usu√°rios](https://docs.robbu.global/docs/center/usuarios)


## Endpoint de Login

Para realizar a autentica√ß√£o preencha a requisi√ß√£o conforme o exemplo abaixo:

**M√©todo:**  `POST`

**URL:** `https://api.robbu.global/v1/login`


  **Company** ‚ûú `Nome da empresa no Invenio Center`

  **Username** ‚ûú `Nome do usu√°rio API`
  
  **Password** ‚ûú `Senha do usu√°rio API`

**Body:**
```
    {
  "Company": "#####",
  "Username": "#####",
  "Password": "#####"
    }

```

**Exemplo de response:**

```
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5...",
  "expires_in": 287971200,
  "refresh_token": "",
  "token_type": "bearer"
}

```

N√£o √© necess√°rio gerar um novo token a cada envio. O campo **expires_in** define sua validade em segundos e, por padr√£o, pode ser considerado v√°lido por at√© 3333 dias. √â importante lembrar que, caso a rota de login seja
 executada novamente, o token anterior ser√° invalidado. Por isso, a recomenda√ß√£o √© armazen√°-lo e solicitar um novo apenas quando a requisi√ß√£o de envio retornar **401 Unauthorized**.

---

## Endpoint de Envio de Mensagens

Com o token em m√£os, basta utilizar a rota de envio para realizar o disparo das mensagens.

**M√©todo:** `POST`

**URL:** `https://api.robbu.global/v1/sendmessage`

O envio deve incluir no cabe√ßalho a autentica√ß√£o no formato: `Authorization: Bearer {access_token}`

**Exemplo de request (completo)**

```json title="POST https://api.robbu.global/v1/sendmessage" showLineNumbers
{
  "invenioPrivateToken": "xxxxxx-xxxxxxx-xxxxxxxx-xxxxxxxx",
  "text": "ol√° usu√°rio",
  "emailSubject": "",
  "channel": 3,
  "templateName": "template1",
  "attendantUserName": "Usu√°rio 1",
  "templateParameters": [
    {
      "parameterName": "PrimeiroNome",
      "parameterValue": "Nome alternativo"
    },
    {
      "parameterName": "Coringa1",
      "parameterValue": "01/01/1993"
    }
  ],
  "source": {
    "countryCode": 55,
    "phoneNumber": 11999999999,
    "prospect": false
  },
  "destination": {
    "countryCode": 55,
    "phoneNumber": 1199999999,
    "email": ""
  },
  "discardSettings": {
    "recentContactLastHours": 0,
    "InAttendance": true
  },
  "contact": {
    "name": "Ana da Silva",
    "customCode": "5150",
    "id": "78905678908",
    "tag": "nometag",
    "jokers": [
      "coringa1",
      "coringa2",
      "coringa3",
      "coringa4",
      "coringa5"
    ],
    "walletClientCode": "CodDefault",
    "updateIfExists": true
  },
  "voiceSettings": {
    "callId": "123123"
  },
  "files": [
    {
      "address": "https://robbublob.blob/download/boletoteste.pdf",
      "base64": "...u5y3i4y5iu345yu345yu345y5y4...",
      "name": "seuboleto.pdf"
    }
  ]
}
```

## Detalhamento dos Campos

###  Par√¢metros da Requisi√ß√£o SendMessage

| **Campo**             | **Descri√ß√£o** |
|------------------------|---------------|
| **InvenioPrivateToken** | Obtido no ambiente administrativo do Invenio Center em `Configura√ß√µes > Conta`. **Obrigat√≥rio** para que a chamada seja aceita. |
| **Text** | Conte√∫do da mensagem em texto livre. Ignorado quando o envio utiliza **template HSM**. S√≥ pode ser usado em contatos com janela de 24h aberta ([saiba mais](https://docs.robbu.global/docs/live/sessao-de-24horas-no-whatsapp)). |
| **EmailSubject** | Usado apenas em mensagens enviadas por **e-mail**, deve ser preenchido com o t√≠tulo do e-mail. |
| **Channel** | Define o canal de envio: `1 = E-mail`, `2 = SMS`, `3 = WhatsApp`. |
| **TemplateName** | Quando o envio √© feito via **HSM**, deve ser preenchido com o nome do template. |
| **TemplateParameters** | Personaliza√ß√£o dos templates com vari√°veis din√¢micas. Veja abaixo. |
| **Source** | Informa√ß√µes da **origem** da mensagem (linha de disparo). Veja abaixo. |
| **Destination** | Informa√ß√µes do **destinat√°rio** da mensagem. Veja abaixo. |
| **DiscardSettings** | Evita disparos desnecess√°rios quando j√° houve contato recente ou atendimento ativo. Veja abaixo. |
| **Contact** | Dados adicionais do contato que podem ser atualizados no disparo. Veja abaixo. |
| **WalletClientCode** | C√≥digo cliente do segmento definido no Invenio, garantindo v√≠nculo com a carteira escolhida. |
| **UpdateIfExists** | Define se as informa√ß√µes do contato devem ser atualizadas (`true` ou `false`). |
| **VoiceSettings** | Deve ser preenchido com o **Call ID de voz** nos fluxos do canal de voz. |
| **Files** | Permite o envio de arquivos anexados. Veja abaixo. |

---

###  TemplateParameters (Par√¢metros de template)

| **Campo**         | **Descri√ß√£o** |
|-------------------|---------------|
| **ParameterName** | Nome da vari√°vel conforme definido no template. |
| **ParameterValue** | Valor que substituir√° a vari√°vel no envio. |

---

###  Source (Origem da Mensagem)

| **Campo**       | **Descri√ß√£o** |
|-----------------|---------------|
| **CountryCode** | C√≥digo do pa√≠s da linha de origem. |
| **PhoneNumber** | N√∫mero de telefone (com DDD) da linha que realizar√° o disparo. |
| **Prospect** | Define a aleatoriza√ß√£o das linhas prospect. <br/>- `false`: a mensagem sair√° exatamente da linha configurada. <br/>- `true`: pode ser enviada por outra linha prospect eleg√≠vel. <br/> [Saiba mais sobre aleatoriza√ß√£o](https://docs.robbu.global/docs/center/canal-whatsapp#aleatoriza%C3%A7%C3%A3o-inteligente). |

---

###  Destination (Destino da Mensagem)

| **Campo**       | **Descri√ß√£o** |
|-----------------|---------------|
| **CountryCode** | C√≥digo do pa√≠s do contato que receber√° a mensagem. |
| **PhoneNumber** | N√∫mero de telefone (com DDD) do contato destinat√°rio. |
| **Email**       | Endere√ßo de e-mail do destinat√°rio (quando o canal for e-mail). |

---

###  DiscardSettings (Descartes)

| **Campo**              | **Descri√ß√£o** |
|------------------------|---------------|
| **RecentContactLastHours** | Quantidade de horas a considerar para descartar o envio. |
| **InAttendance** | `true`: descarta contatos em atendimento. <br/> `false`: envia mesmo que o contato esteja em atendimento. |

---

###  Contact (Contato)

| **Campo**       | **Descri√ß√£o** |
|-----------------|---------------|
| **Name**        | Atualiza o nome do contato no Invenio. |
| **CustomCode**  | C√≥digo personalizado usado pela empresa para categorizar contatos. |
| **Id**          | Atualiza o CPF/CNPJ do contato. |
| **Tag**         | Categoriza contatos para facilitar a busca ([saiba mais](https://docs.robbu.global/docs/live/edicao-de-tags)). |
| **Jokers**      | Coringas din√¢micos utilizados no disparo. <br/>- `Joker 1 a 4`: at√© 300 caracteres. <br/>- `Joker 5`: at√© 3000 caracteres. |

---

###  Files (Anexos)

| **Campo**  | **Descri√ß√£o** |
|------------|---------------|
| **Address** | URL da m√≠dia a ser enviada. |
| **Base64**  | C√≥digo em base64 da m√≠dia. |
| **Name**    | Nome do arquivo com extens√£o (ex.: `boleto.pdf`). |

> ‚ÑπÔ∏è **Observa√ß√£o**:  
> - Em **templates (HSM)** s√≥ √© permitido **1 arquivo por disparo**.  
> - Em **mensagens livres**, √© poss√≠vel enviar m√∫ltiplos arquivos (ex.: ZIP).  
> - Apesar de permitido, o envio em ZIP pode n√£o ser compat√≠vel com todos os modelos de celulares.  


---

## Responses API Send Message

Ao realizar uma chamada √† API, diferentes c√≥digos de status podem ser retornados, indicando o resultado do disparo. A seguir, listamos os principais responses que podem ser encontrados, juntamente com seu significado, para auxiliar no monitoramento e tratamento de respostas:


| **C√≥digo** | **Descri√ß√£o**                                                                 |
|------------|-------------------------------------------------------------------------------|
| **200 OK** | Mensagem enviada corretamente.                                                |
| **400 Bad Request** | Preenchimento incorreto ou incompleto de par√¢metros.                  |
| **401 Unauthorized** | Token inv√°lido ou expirado.                                          |
| **404 Not Found** | URL incorreta.                                                          |
| **500 Internal Server Error** | Erro interno da API.                                        |

> ‚ÑπÔ∏è **Observa√ß√£o**: √â importante observar que a API n√£o retorna mensagens de erro detalhadas em casos de falha de envio nos canais externos (como erros da Meta). Nesses casos, a valida√ß√£o deve ser feita diretamente no **Invenio Center**, onde est√£o dispon√≠veis os logs e relat√≥rios de entrega.


## Exemplos de Requisi√ß√µes


<Accordion title="Preenchimento com par√¢metros de templates">

  ```json title="POST https://api.robbu.global/v1/sendmessage" showLineNumbers
  {
    "invenioPrivateToken": "af5addfsdf52-a5dfsc-44fdf6-80bc-eda1d2af8",
    "text": "",
    "emailSubject": "",
    "channel": 3,
    "templateName": "comercial_av",
    "attendantUserName": "",
    "templateParameters": [
        {
            "parameterName": "Cliente",
            "parameterValue": "Roberto"
        },
        {
            "parameterName": "Site",
            "parameterValue": "www.sitecs.com.br"
        }
    ],
    "source": {
        "countryCode": 55,
        "phoneNumber": 11999999999,
        "prospect": false
    },
    "destination": {
        "countryCode": 55,
        "phoneNumber": 11999999999,
        "email": ""
    },
    "discardSettings": {
        "recentContactLastHours": 0,
        "InAttendance": false
    },
    "contact": {
        "name": "",
        "customCode": "",
        "id": "",
        "tag": "",
        "jokers": [
            "",
            "",
            "",
            "",
            ""
        ],
        "walletClientCode": "comercial",
        "updateIfExists": true
    }
}
  ```
**Template configurado no Invenio Center**

<img src="https://robbublob.blob.core.windows.net/docs/sendmessage/templatesendmessage.png" />
<img src="https://robbublob.blob.core.windows.net/docs/sendmessage/sendmessagetemplateedit.png" />

</Accordion>

<Accordion title="Envio de texto livre com dois arquivos">

  ```json title="POST https://api.robbu.global/v1/sendmessage" showLineNumbers
  
    {
    "invenioPrivateToken": "c8881dhjg0a-1c13-4407hj4-a26d-8dty8i7t8gg7g",
    "text": "Segue os arquivos do ultimo evento",
    "emailSubject": "",
    "channel": 3,
    "templateName": "",
    "attendantUserName": "Operador",
    "templateParameters": [
        {
            "parameterName": "",
            "parameterValue": ""
        },
        {
            "parameterName": "",
            "parameterValue": ""
        }
    ],
    "source": {
        "countryCode": 55,
        "phoneNumber": 11999999999,
        "prospect": false
    },
    "destination": {
        "countryCode": 55,
        "phoneNumber": 11999999999,
        "email": ""
    },
    "discardSettings": {
        "recentContactLastHours": 0,
        "InAttendance": false
    },
    "contact": {
        "name": "Cliente",
        "customCode": "",
        "id": "2133125456725",
        "tag": "",
        "jokers": [
            "",
            "",
            "",
            "",
            ""
        ],
        "walletClientCode": "financeiro",
        "updateIfExists": true
    },
    "files": [
    {
      "address": "",
      "base64": "JVBERi0xLjMKJcTl8uXrp....",
      "name": "seuboleto.pdf"

    },
    
    {
      "address": "",
      "base64": "aoijdpisjapsijjsjjsker03nfdikds.....",
      "name": "seuboleto2.pdf"
    }
  
  ]
  
}
  ```
**Arquivos recebidos em uma conversa**

<img src="https://robbublob.blob.core.windows.net/docs/sendmessage/exemplo2arquivoswpp.png" />

</Accordion>

- Envio com preenchimento de coringas
- Envio de e-mail
- Envio de carrossel
- Envio de template de autentica√ß√£o


---

## üîó Links e assuntos relacionados  

- [Configura√ß√µes Gerais da Conta](https://docs.robbu.global/docs/center/configuracoes-gerais-da%20conta)  
- [Usu√°rios no Invenio Center](https://docs.robbu.global/docs/center/usuarios)  
- [Filtros de Busca de Contatos](https://docs.robbu.global/docs/center/filtros-de-busca-de-contatos)  
- [Segmentos no Invenio Center](https://docs.robbu.global/docs/center/segmentos)  
- [Templates de E-mail](https://docs.robbu.global/docs/center/templates-de-email)  
- [Como Criar Templates no WhatsApp](https://docs.robbu.global/docs/center/como-criar-templates-whatsapp)  
- [Canais de Atendimento no Invenio Center](https://docs.robbu.global/docs/center/canais-atendimento)  
- [Sess√£o de 24h no WhatsApp](https://docs.robbu.global/docs/live/sessao-de-24horas-no-whatsapp)  
- [Filtros e Menus de Busca no Invenio Live](https://docs.robbu.global/docs/live/filtros-e-menus-de-busca)  
- [Filtro por Canal no Invenio Live](https://docs.robbu.global/docs/live/filtro-por-canal)  

---

## ‚ÅâÔ∏è Perguntas Frequentes (FAQ)

<AccordionGroup>
  <Accordion title="A autentica√ß√£o precisa ser feita em todos os envios?">
    N√£o. O token obtido na rota de login possui validade definida no campo expires_in. Ele deve ser reutilizado at√© expirar, solicitando um novo apenas quando houver retorno **401 Unauthorized**.
  </Accordion>

  <Accordion title="O campo text pode ser usado em qualquer envio?">
    N√£o. Esse campo √© ignorado em envios que utilizam **template HSM** e s√≥ pode ser usado para contatos que estejam dentro da **janela de 24 horas aberta no WhatsApp**.
  </Accordion>

  <Accordion title="Quantos arquivos posso enviar em um √∫nico disparo?">
    - Em **templates HSM**: apenas **1 arquivo** √© permitido.  
    - Em **mensagens livres**: m√∫ltiplos arquivos podem ser enviados, incluindo ZIP (com ressalva de compatibilidade em alguns dispositivos).
  </Accordion>

  <Accordion title="O que acontece se eu executar novamente a rota de login?">
    O token anterior ser√° automaticamente **invalidado**. Apenas o √∫ltimo token gerado ser√° v√°lido para as requisi√ß√µes.
  </Accordion>

  <Accordion title="Como funciona o par√¢metro `discardSettings`?">
    Ele evita envios duplicados ou desnecess√°rios:  
    - `recentContactLastHours`: define em quantas horas o envio deve ser descartado se j√° houver intera√ß√£o anterior.  
    - `InAttendance`: quando configurado como `true`, impede disparo para contatos que j√° est√£o em atendimento.
  </Accordion>

  <Accordion title="√â poss√≠vel atualizar dados do contato durante o envio?">
    Sim. O objeto **Contact** permite atualizar informa√ß√µes como **nome, documento, tags e coringas**, al√©m de definir se os dados devem ser sobrescritos (`updateIfExists`).
  </Accordion>

  <Accordion title="Onde verificar erros de envio detalhados?">
    A API retorna apenas status gerais (200, 400, 401, etc.).  
    Para detalhes sobre falhas em canais externos (como a Meta/WhatsApp), √© necess√°rio consultar os **logs e relat√≥rios de entrega** diretamente no **Invenio Center**.
  </Accordion>
</AccordionGroup>





